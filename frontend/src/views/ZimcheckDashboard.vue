<template>
  <div class="container">
    <h2>ZimCheck Dashboard</h2>
    <div class="container">
      <div class="row">
        <div class="col btn btn-light position-relative me-1">
          Total Integrity
          <span class="badge bg-warning">
            {{ dictTotals.integrity }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total Empty
          <span class="badge bg-warning">
            {{ dictTotals.empty }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total metadata
          <span class="badge bg-warning">
            {{ dictTotals.metadata }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total favicon
          <span class="badge bg-warning">
            {{ dictTotals.favicon }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total main_page
          <span class="badge bg-warning">
            {{ dictTotals.main_page }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total redundant
          <span class="badge bg-warning">
            {{ dictTotals.redundant }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total url_internal
          <span class="badge bg-warning">
            {{ dictTotals.url_internal }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total url_external
          <span class="badge bg-warning">
            {{ dictTotals.url_external }}
          </span>
        </div>
        <div class="col btn btn-light position-relative me-1">
          Total redirect
          <span class="badge bg-warning">
            {{ dictTotals.redirect }}
          </span>
        </div>
      </div>
    </div>
    <hr>
    <table
      class="table table-sm table-striped table-responsive"
    >
      <thead>
        <tr>
          <th>Scraper</th>
          <th>integrity</th>
          <th>empty</th>
          <th>metadata</th>
          <th>favicon</th>
          <th>main_page</th>
          <th>redundant</th>
          <th>url_internal</th>
          <th>url_external</th>
          <th>redirect</th>
        </tr>
      </thead>
      <tbody>
        <tr
          v-for="(errors, scraper) in checkData"
          id="hide"
          :key="scraper"
        >
          <td>
            {{ scraper }}
          </td>
          <td>
            {{ Math.round((errors.integrity * 100) / dictTotals.integrity) }} %
          </td>
          <td>
            {{ Math.round((errors.empty * 100) / dictTotals.empty) }} %
          </td>
          <td>
            {{ Math.round((errors.metadata * 100) / dictTotals.metadata) }} %
          </td>
          <td>
            {{ Math.round((errors.favicon * 100) / dictTotals.favicon) }} %
          </td>
          <td>
            {{ Math.round((errors.main_page * 100) / dictTotals.main_page) }} %
          </td>
          <td>
            {{ Math.round((errors.redundant * 100) / dictTotals.redundant) }} %
          </td>
          <td>
            {{ Math.round((errors.url_internal * 100) / dictTotals.url_internal) }} %
          </td>
          <td>
            {{ Math.round((errors.url_external * 100) / dictTotals.url_external) }} %
          </td>
          <td>
            {{ Math.round((errors.redirect * 100) / dictTotals.redirect) }} %
          </td>
        </tr>
      </tbody>
    </table>
    <ErrorMessage
      v-if="error"
      :message="error"
    />
  </div>
</template>

<script>
import Common from '../Common.mixin.js'
import ErrorMessage from '../components/ErrorMessage.vue'

export default {
  name: 'ZimcheckDashboard',
  components: {
    ErrorMessage
  },
  mixins: [Common],
  data () {
    return {
      checkData: null,
      dictTotals: null,
      error: null // error message generated by API
    }
  },
  created () {
    const parent = this
    this.startLoading()

    const url = '/dashboard'

    this.queryAPI('GET', url)
      .then(function (response) {
        parent.checkData = response.data.checkData
        parent.dictTotals = response.data.dictTotals
        parent.endLoading()
      })
      .catch(function (error) {
        parent.standardErrorHandling(error)
        parent.endLoading()
      })
  }
}
</script>
